// jQuery geolocation.edit plugin v0.0.8 (2013-02-08)
// Copyright (c) 2012 Milos Popovic <the.elephant@gmail.com>
// Freely distributable under the MIT license.
// see: http://github.com/miloss/jquery-geolocation-edit
(function(a){var g,e={},h;g=[];e.main=function(b){var c=this,d,f,e;if("undefined"===typeof b.lat||"undefined"===typeof b.lng)a.error("Please provide 'lat' and 'lng' options for jQuery.geolocate");else if("undefined"===typeof google||"undefined"===typeof google.maps)g.push(function(){a(c).geolocate(b)}),h();else if(d=a.extend(!0,{address:[],changeOnEdit:!1,mapOptions:{zoom:14,mapTypeId:google.maps.MapTypeId.ROADMAP,mapTypeControl:!1,streetViewControl:!1},markerOptions:{draggable:!0,animation:google.maps.Animation.DROP}, geoCallback:function(){}},b),a(this).data("opts",d),f=parseFloat(a(d.lat).val()),e=parseFloat(a(d.lng).val()),!isNaN(f)&&!isNaN(e)&&(f=new google.maps.LatLng(f,e),a(this).geolocate({},"initMap",f)),d.changeOnEdit&&(a(d.lat).change(function(){}),a(d.lng).change(function(){})),e=d.address.length,0<e)for(f=0;f<e;f++)a(d.address[f]).change(function(){a(c).geolocate({},"callGeocoding")})};e.initMap=function(b){var c=a(this).get(0),d,e=a.data(c,"opts");d=new google.maps.Map(c,a.extend({center:b},e.mapOptions)); b=a.extend({map:d,position:b},e.markerOptions);b=new google.maps.Marker(b);a.data(c,"map",d);a.data(c,"marker",b);google.maps.event.addListener(b,"dragend",function(){a(c).geolocate({},"getMarkerLocation")})};e.callGeocoding=function(){for(var b=a(this).get(0),c="",d=a.data(b,"opts"),e=d.address.length,g=d.geoCallback;e--;)c+=a(d.address[e]).val();(new google.maps.Geocoder).geocode({address:c},function(c,e){var d,f,j,h;g(c,e);f=c[0];"undefined"!==typeof f&&(j=a.data(b,"map"),h=a.data(b,"marker"), d=f.geometry.location,j.panToBounds(f.geometry.viewport),j.panTo(d),h.setPosition(d),a(b).geolocate({},"getMarkerLocation"))})};e.getMarkerLocation=function(){var b=a(this).get(0),c=a.data(b,"marker"),b=a.data(b,"opts"),c=c.getPosition();a(b.lat).val(c.lat());a(b.lng).val(c.lng())};a.fn.geolocate=function(b,c){var d=Array.prototype.slice;if("undefined"===typeof c){if("string"===typeof b&&"undefined"!==typeof e[b])return e[b].apply(this,d.call(arguments,1));a(this).geolocate({},"main",b)}else{if(e[c])return e[c].apply(this, d.call(arguments,2));a.error("Method "+c+" does not exist on jQuery.geolocate")}return this};a.fn.geolocateGMapsLoaded=function(){for(;g.length;)g.shift()()};var k=!1;h=function(){var a;k||(k=!0,a=document.createElement("script"),a.type="text/javascript",a.src="http://maps.googleapis.com/maps/api/js?sensor=false&callback=$.fn.geolocateGMapsLoaded",document.body.appendChild(a))}})(jQuery);
